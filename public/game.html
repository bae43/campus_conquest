<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">

	<head>

		<title>Join Game</title>

		<meta charset="utf-8">

		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="/css/fonts.css" />
		<link rel="stylesheet" href="/css/global.css" />
		<link rel="stylesheet" href="/css/pane.css" />
		<link rel="stylesheet" href="/css/game.css" />
	</head>

	<body>
		<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
		<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
		<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
		<script src="js/lib/Three-debug.js"></script>
		<script src="js/lib/Projector.js"></script>
		<script src="js/lib/CanvasRenderer.js"></script>
		<script src="js/lib/Detector.js"></script>
		<script src="js/lib/Stats.js"></script>

		<script src="js/Constants.js"></script>
		<script src="js/World.js"></script>
		<script src="js/Map.js"></script>
		<script src="js/StateHandler.js"></script>
		<!-- <script src="js/ControlPanel.js"></script> -->
		<script src="js/ClientListeners.js"></script>
		<script src="js/Graphics.js"></script>
		<script src="js/WindowHandler.js"></script>
		<script src="js/ControlPanelHandler.js"></script>
		<script src="js/InitGame.js"></script>

		<div class='pane' id='gamelist-pane' style="display: block;">
			<div class='card'>
				<div class='card-contents'>
					<div class='card-header'>
						<div class='card-header'>
							<h1> Open Games </h1>
							<div class ="button right">
								New Game
							</div>
						</div>

					</div>
					<div class="card-body">
						<table id='open-games' style="width:100%">
							<tr>
								<th>Name</th>
								<th>Description</th>
								<th>Teams</th>
								<th>Stage</th>

							</tr>

						</table>
					</div>
				</div>

			</div>
		</div>

		<div class='pane' id='create-pane' style="display: none;">
			<div class='card'>
				<div class='card-contents'>
					<div class = 'button' id = 'new-game-back-button'>
						Back
					</div>
					<div class='card-header'>
						<h1> New Game</h1>
					</div>

					<form id="new-game-form">
						<div>
							Name:
							<input type="text" name="id">
						</div>
						<div>
							Description:
							<input type="text" name="desc">
						</div>
						<div>
							Team Game:
							<div class='checkbox'>
								<input type="checkbox" name="input-isteam" id='is-team-checkbox'>
								<label for="is-team-checkbox"></label>
							</div>
						</div>

						<div>
							<a href="#" class="button" id="create-game-button" >Create Game</a>
						</div>

					</form>
				</div>

			</div>
		</div>

		<div class='pane' id='signin-pane' style="display: none;">
			<div class='card'>
				<div class='card-contents'>
					<div class='card-header'>
						<h1 id="join-game-header"> Join Game</h1>
					</div>
					<form id="form">
						<div style="display:none;">
							Game ID: <select id='input-game-id'></select>
						</div>
						<div>

							<input type="text" id="input-player-name" name="player-name" class = "field" placeholder="Name">

							<input type="text" id="input-player-id" name="player-id" class = "field" placeholder="NetID">
						</div>
						<div>
							Team <span id="myteam"> </span>
							</script>
							<ul id='team-list'></ul>
						</div>
						<div>
							<a href="#" class="button" id="join-button">Join Game</a>
						</div>

					</form>
				</div>

			</div>
		</div>

		<div class='pane' id='lobby-pane' style="display: none;">
			<div class='card'>
				<div class='card-contents'>
					<div class='card-header'>
						<h1><span id='lobby-game-id'>Lobby</span></h1>
					</div>
					<table id="lobby-table">

					</table>
					<div>
						<a href="#" class="button" id="start-game-button">Start</a>
					</div>

				</div>

			</div>
		</div>

		<div id="game-window" style="display: none;">
			<nav>
				<img src="rsc/images/logos/logo_small_inline.png"/>

				<a id='nav-name' > Me
				<ul>
					<li class="player_name"></li>
					<li>
						Stats
					</li>
					<li>
						Log Out
					</li>
				</ul></a>
				<a id='nav-options' > Options
				<ul>
					<li>
						Graphics
					</li>
					<li>
						Sound
					</li>
				</ul></a>
				<a id='nav-menu' > Menu </a>

			</nav>
			<div id='waiting-on' class='centered-window' style="display: none;">
				<div class='container'>
					<h1> Waiting on </h1>
					<table id="waiting-on-list">

					</table>
				</div>
			</div>
			<div id='new-stage-intro' class='centered-window fade-in-out' style="display: none;">
				<div class='container'>
					<h1> <span id="new-stage-text"></span> Stage</h1>
				</div>
			</div>
			<div id='attack-panel' class='centered-window' style="display: none;">
				<div class='container'>
					<h1><span class='from'> </span> >> <span class="to"> </span></h1>

					<span id="attack-unit-count" class='microtext'>Units: ERROR</span>
					<div id="attack-slider">
						<div id="attack-slider-inner-line"></div>
					</div>

					<div class='button-set'>
						<div class='button cancel'>
							Cancel
						</div>
						<div class='button okay'>
							Okay
						</div>
					</div>
				</div>
			</div>
			<div id="control-panel">
				<header>
					<div class='team icon'></div><h2 class="team name"></h2>
				</header>
				<div id="panel-wheel"></div>
				<div id='panel-reinforcement-info' style='display: none;'>
					<span>Reinforcements: </span>
					<span id='reinforcements-remaining'> </span>
				</div>
				<div id="current-selection">

				</div>
				<ul id="messages"></ul>

				<input id="msgs-global" autocomplete="off" placeholder="hit enter to send a message"/>
				<div id="button-continue" class='button' style="display: none;">
					Continue
				</div>
				<div id="button-done" class='button' style="display: none;">
					Done
				</div>
				<div id="info">
					&copy; 2014 Campus Conquest
				</div>
			</div>
			<div id = "container">
				<canvas id="canvas2D"></canvas>
				<canvas id="canvas3D"></canvas>
			</div>
		</div>
		<script>
      $(document).ready(function() {
        var init_data = {};

        $('#new-game-form').submit(function(e) {
          e.preventDefault();
          // Prevents the page from refreshing
          var $this = $(this);
          // `this` refers to the current form element
          console.log($this);
          $.post("/create-game", $(this).serialize(), function(data) {
            console.log('data', data);
          }, "json" // The format the response should be in
          );
        });

        $("#create-game-button").click(function(e) {
          $('#new-game-form').submit();
        });

        $.ajax({
          url : "/open-games",
        }).done(function(data) {
          var join_game_id = window.location.hash.replace(/^#/, '');

          for (var i = 0; i < data.length; i++) {
            var id = data[i].id;
            if (join_game_id == id) {
              init_data.game_id = join_game_id;
              $('#join-game-header').text(join_game_id);
              $('.pane').hide();
              $('#signin-pane').show();
              break;
            }
            $('#input-game-id').append('<option value="' + id + '">' + id + '</option>')
          }
        });

        $.ajax({
          url : "/open-games",
        }).done(function(data) {

          for (var i = 0; i < data.length; i++) {
            var game = data[i];
            var row = $('<tr/>');
            row.append('<td>' + game.id + '</td>');
            row.append('<td>' + game.desc + '</td>');

            $.ajax({
              url : "/state",
              data : {
                id : game.id
              }
            }).done( function(data) {
              var row = this;
              row.append('<td>' + data.team_order.length + '</td>');
              row.append('<td>' + data.stage + '</td>');
              $('#open-games').append(row);

            }.bind(row));

          }
          $('#open-games').on('click', 'tr', function() {
            $('.pane').hide();
            $('#signin-pane').show();
            var game_id = this.children[0].innerText
            $('#join-game-header').text(game_id);
            init_data.game_id = game_id;
          });
        });

        var selected = 'hotel';
        $('#myteam').text(TEAM_DATA[selected].name);
        for (id in TEAM_DATA) {
          $('#team-list').append('<li><label>	<input type="radio" name="team-choice" value="' + id + '" ' + (id == selected ? 'checked' : '') + '/><img src="rsc/images/flags/128/' + id + '.jpg"> </label></li>');
        }

        $('input:radio[name=team-choice]').click(function(e) {
          $('#myteam').text(e.target.value);
        });
        $('img').on('dragstart', function(event) {
          event.preventDefault();
        });

        $('#join-button').click(function() {

          init_data.player = {};
          init_data.player.id = $('#input-player-id').val();
          init_data.player.name = $('#input-player-name').val();
          init_data.player.team = $('input:radio[name=team-choice]:checked').val();

          initGame(init_data);

          //$('#signin-pane').hide();
          //$('#lobby-pane').show();
          //$('#lobby-game-id').text($('#input-game-id').val());
          //$('#lobby-table').append('<tr class="team-style ' + $('input:radio[name=team-choice]:checked').val() + '"><td class="team-icon small ' + $('input:radio[name=team-choice]:checked').val() + '"></td><td >' + $('#input-player-name').val() + '</td><td class="faded-text">' + $('#input-player-id').val() + '</td><td class="team-icon small"></td></tr>');
        });

        $('#start-game-button').click(function() {

        });

      });

      // initGame({
      // player_id : 'bae43',
      // player_name : 'Bryce Evans',
      // game_id : 'test',
      // team_id : 'eng',
      // });

		</script>
	</body>

</html>

